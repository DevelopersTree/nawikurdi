{"id":"index.js","dependencies":[{"name":"/Users/hozan/Desktop/devstree/nawikurdi/API/package.json","includedInParent":true,"mtime":1590877042665},{"name":"./general","loc":{"line":1,"column":23},"parent":"/Users/hozan/Desktop/devstree/nawikurdi/API/public/js/index.js","resolved":"/Users/hozan/Desktop/devstree/nawikurdi/API/public/js/general.js"},{"name":"superagent","loc":{"line":2,"column":23},"parent":"/Users/hozan/Desktop/devstree/nawikurdi/API/public/js/index.js","resolved":"/Users/hozan/Desktop/devstree/nawikurdi/API/node_modules/superagent/lib/client.js"},{"name":"jquery","loc":{"line":3,"column":14},"parent":"/Users/hozan/Desktop/devstree/nawikurdi/API/public/js/index.js","resolved":"/Users/hozan/Desktop/devstree/nawikurdi/API/node_modules/jquery/dist/jquery.js"},{"name":"notyf","loc":{"line":4,"column":22},"parent":"/Users/hozan/Desktop/devstree/nawikurdi/API/public/js/index.js","resolved":"/Users/hozan/Desktop/devstree/nawikurdi/API/node_modules/notyf/notyf.es.js"}],"generated":{"js":"\"use strict\";\n\nvar _general = require(\"./general\");\n\nvar _superagent = _interopRequireDefault(require(\"superagent\"));\n\nvar _jquery = _interopRequireDefault(require(\"jquery\"));\n\nvar _notyf = require(\"notyf\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// Create an instance of Notyf\nvar notyf = new _notyf.Notyf(); // scroll logic\n\nvar mybutton = document.getElementById(\"to-top\");\n\nwindow.onscroll = function () {\n  scrollFunction();\n};\n\nfunction scrollFunction() {\n  try {\n    if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {\n      mybutton.style.display = \"block\";\n    } else {\n      mybutton.style.display = \"none\";\n    }\n  } catch (e) {}\n}\n\nfunction topFunction() {\n  document.body.scrollTop = 0; // For Safari\n\n  document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera\n} // end of scroll logic\n\n\nvar params = {\n  limit: 10,\n  offset: 0\n};\n\nfunction load(params) {\n  return _superagent.default.get(\"/api\").query(params).then(function (data) {\n    return data.body.names;\n  }).catch(function (err) {\n    return [];\n  });\n}\n\nfunction vote(data) {\n  var cb = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {};\n  return _superagent.default.post(\"/api/vote\").send(data).end(function (err, res) {\n    cb(err, res);\n  });\n}\n\nfunction display(container, data) {\n  var mode = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'append';\n  // mode will be one of overwrite, append, prepend\n  var alterMethod = 'html';\n\n  if (mode === 'append') {\n    alterMethod = 'append';\n  } else if (mode == 'prepend') {\n    alterMethod = 'prepend';\n  }\n\n  var html = \"\";\n  data.map(function (record) {\n    var gender = 'هاوبه‌ش';\n    if (record.gender == 'M' || record.gender == 'm') gender = 'كور';else if (record.gender == 'F' || record.gender == 'F') gender = 'كچ';\n    html += \"\\n            <a  class=\\\"col col-3 col-md col-sm card-container\\\">\\n                <div class=\\\"card\\\">\\n                    <h3 class=\\\"card-title\\\">\".concat(record.name, \" ( \").concat(gender, \" ) </h3>\\n                    <p class=\\\"card-body\\\">\\n                        \").concat(record.desc, \"\\n                    \\u200C</p>\\n                    <div class=\\\"card-footer\\\">\\n                        <div class=\\\"btn-group _3btn\\\">\\n                            <button class=\\\"down-vote\\\" data-id=\\\"\").concat(record.nameId, \"\\\"><i class=\\\"fas fa-arrow-down\\\"></i> ( \").concat(record.negative_votes, \" )</button>\\n                            <button class=\\\"up-vote\\\" data-id=\\\"\").concat(record.nameId, \"\\\"><i class=\\\"fas fa-arrow-up\\\"></i>   ( \").concat(record.positive_votes, \" ) </button>\\n                            <button class=\\\"make-fav\\\" data-id=\\\"\").concat(record.nameId, \"\\\" ><i class=\\\"far fa-heart\\\"></i>  </button>\\n                        </div>\\n                    </div>\\n                </div>\\n            </a>\\n        \");\n    return null;\n  });\n  (0, _jquery.default)(container)[alterMethod](html);\n\n  if (data.length == 0) {\n    showNotFound();\n  } else {\n    hideNotFound();\n  }\n\n  return html;\n}\n\nfunction showLoader() {\n  (0, _jquery.default)('.names-container').append(\"\\n        <a class=\\\"col col-3 col-md col-sm loader\\\" >\\n            <h3 class=\\\"txt-center\\\"><i class=\\\"fas fa-spinner fa-spin\\\"></i></h3>\\n        </a> \\n    \");\n}\n\nfunction showNotFound() {\n  (0, _jquery.default)('.names-container').prepend(\"\\n        <div class=\\\"col col-md col-sm  notfound-container\\\">\\n            <img src=\\\"/images/child.webp\\\"/>\\n            <p>\\u0628\\u0628\\u0648\\u0631\\u0647\\u200C \\u0647\\u06CC\\u0686 \\u0646\\u0627\\u0648\\u06CE\\u0643 \\u0646\\u0647\\u200C\\u062F\\u06C6\\u0632\\u0631\\u0627\\u06CC\\u0647\\u200C\\u0648\\u0647\\u200C \\u062F\\u0647\\u200C\\u0633\\u062A\\u0647\\u200C\\u0648\\u0627\\u0698\\u0647\\u200C\\u06CC\\u0647\\u200C\\u0643\\u06CC \\u062C\\u06CC\\u0627\\u0648\\u0627\\u0632 \\u0628\\u0647\\u200C\\u0643\\u0627\\u0631\\u0628\\u0647\\u06CE\\u0646\\u0647\\u200C</p>\\n        </div>\\n    \");\n}\n\nfunction hideNotFound() {\n  (0, _jquery.default)('.notfound-container').remove();\n}\n\nfunction hideLoader() {\n  (0, _jquery.default)('.loader').remove();\n}\n\nfunction getCookie(cname) {\n  var name = cname + \"=\";\n  var decodedCookie = decodeURIComponent(document.cookie);\n  var ca = decodedCookie.split(';');\n\n  for (var i = 0; i < ca.length; i++) {\n    var c = ca[i];\n\n    while (c.charAt(0) == ' ') {\n      c = c.substring(1);\n    }\n\n    if (c.indexOf(name) == 0) {\n      return c.substring(name.length, c.length);\n    }\n  }\n\n  return \"\";\n}\n\nfunction makeHeartsRed() {\n  var fav_ids = localStorage.getItem('fav_ids');\n\n  if (fav_ids) {\n    fav_ids = fav_ids.split(',');\n    fav_ids.forEach(function (id) {\n      (0, _jquery.default)(\".make-fav[data-id=\".concat(id, \"]\")).removeClass('make-fav').addClass('remove-fav').html('<i class=\"fas fa-heart txt-red\"></i>');\n    });\n  }\n}\n\nmodule.exports = {\n  init: function init() {\n    window.topFunction = topFunction;\n    makeHeartsRed();\n    (0, _jquery.default)(window).scroll(function () {\n      var triggerMargin = 100;\n\n      if ((0, _jquery.default)(window).scrollTop() >= (0, _jquery.default)(document).height() - (0, _jquery.default)(window).height() - triggerMargin) {\n        var page = (0, _jquery.default)('body').data('page') || 1;\n        var calculatedOffset = params.limit * page;\n        params.offset = calculatedOffset;\n        (0, _jquery.default)('body').data('page', ++page);\n        showLoader();\n        load(params).then(function (data) {\n          hideLoader();\n          display('.names-container', data, 'append');\n          makeHeartsRed();\n        });\n      }\n    });\n    (0, _jquery.default)('.input-filter').keyup((0, _general.debounce)(function () {\n      (0, _jquery.default)('body').data('page', 1);\n      params.offset = 0;\n      var val = (0, _jquery.default)(this).val();\n      if (val.trim() != '') params.q = val;else delete params.q;\n      showLoader();\n      load(params).then(function (data) {\n        hideLoader();\n        display('.names-container', data, 'overwrite');\n        makeHeartsRed();\n      });\n    }, 300));\n    (0, _jquery.default)('.gender-filter').click(function () {\n      (0, _jquery.default)('body').data('page', 1);\n      params.offset = 0;\n      var val = \"\".concat((0, _jquery.default)(this).data('value'));\n      if (val.trim() != '-1') params.gender = val;else delete params.gender;\n      (0, _jquery.default)(\".gender-filter\").removeClass(\"active\");\n      (0, _jquery.default)(this).addClass(\"active\");\n      showLoader();\n      load(params).then(function (data) {\n        hideLoader();\n        display('.names-container', data, 'overwrite');\n        makeHeartsRed();\n      });\n    });\n    (0, _jquery.default)('.popularity-filter').click(function () {\n      (0, _jquery.default)('body').data('page', 1);\n      params.offset = 0;\n      var val = \"\".concat((0, _jquery.default)(this).data('value'));\n      if (val.trim() != '-1') params.sort = val;else delete params.sort;\n      (0, _jquery.default)(\".popularity-filter\").removeClass(\"active\");\n      (0, _jquery.default)(this).addClass(\"active\");\n      showLoader();\n      load(params).then(function (data) {\n        hideLoader();\n        display('.names-container', data, 'overwrite');\n        makeHeartsRed();\n      });\n    });\n    (0, _jquery.default)(document).delegate('.up-vote', 'click', function () {\n      var btn = this;\n      vote({\n        name_id: (0, _jquery.default)(this).data('id'),\n        uid: getCookie('uid'),\n        impact: 'positive'\n      }, function (err, res) {\n        if (err) {\n          var errors = err.response.body.errors;\n          notyf.error(errors[0].msg);\n        } else {\n          (0, _jquery.default)(btn).html(\"<i class=\\\"fas fa-check\\\"></i> \\u0646\\u06CE\\u0631\\u062F\\u0631\\u0627\");\n        }\n      });\n    });\n    (0, _jquery.default)(document).delegate('.down-vote', 'click', function () {\n      var btn = this;\n      vote({\n        name_id: (0, _jquery.default)(this).data('id'),\n        uid: getCookie('uid'),\n        impact: 'negative'\n      }, function (err, res) {\n        if (err) {\n          var errors = err.response.body.errors;\n          notyf.error(errors[0].msg);\n        } else {\n          (0, _jquery.default)(btn).html(\"<i class=\\\"fas fa-check\\\"></i> \\u0646\\u06CE\\u0631\\u062F\\u0631\\u0627\");\n        }\n      });\n    });\n    (0, _jquery.default)(document).delegate('.make-fav', 'click', function () {\n      var favs = localStorage.getItem('favs');\n      var id = (0, _jquery.default)(this).data('id');\n      (0, _jquery.default)(this).removeClass('make-fav').addClass('remove-fav').html('<i class=\"fas fa-heart txt-red\"></i>');\n      var html = \"<a class=\\\"col col-3 col-md col-sm card-container\\\">\".concat((0, _jquery.default)(this).parents('.card-container').html(), \"</a>\");\n      var fav_ids = localStorage.getItem('fav_ids');\n\n      if (fav_ids) {\n        fav_ids = fav_ids.split(',');\n\n        if (fav_ids.indexOf(id) <= -1) {\n          fav_ids.push(id);\n          localStorage.setItem('fav_ids', fav_ids.join(','));\n        }\n      } else {\n        localStorage.setItem('fav_ids', [id].join(','));\n      }\n\n      if (favs) {\n        favs = JSON.parse(favs);\n        favs[id] = html;\n        localStorage.setItem('favs', JSON.stringify(favs));\n      } else {\n        var newFavs = {};\n        newFavs[id] = html;\n        localStorage.setItem('favs', JSON.stringify(newFavs));\n      }\n    });\n    (0, _jquery.default)(document).delegate('.remove-fav', 'click', function () {\n      var favs = localStorage.getItem('favs');\n      var fav_ids = localStorage.getItem('fav_ids');\n      var id = (0, _jquery.default)(this).data('id');\n\n      if (favs) {\n        favs = JSON.parse(favs);\n        delete favs[id];\n        localStorage.setItem('favs', JSON.stringify(favs));\n      }\n\n      if (fav_ids) {\n        fav_ids = fav_ids.split(',');\n        var index = fav_ids.indexOf(id + \"\");\n        console.log(fav_ids);\n\n        if (index > -1) {\n          fav_ids.splice(index, 1);\n        }\n\n        localStorage.setItem('fav_ids', fav_ids.join(','));\n      }\n\n      (0, _jquery.default)(this).removeClass('remove-fav').addClass('make-fav').html('<i class=\"far fa-heart\"></i>');\n    });\n  }\n};"},"sourceMaps":null,"error":null,"hash":"2e14c53d866921d4ac81f148568d0ce8","cacheData":{"env":{}}}